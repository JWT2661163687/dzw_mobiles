<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>

	<body>
		<div id="fieldvehiclesapp" style="background-color: white;color:#F56C6C">
			<el-row :gutter="20">
				<el-col :span="16">
					<div>
						<h3>外勤车辆</h3></div>
				</el-col>
				<el-col :span="8">
					<div>
						<el-button size="mini" style="float: right;background-color: white;color:#F56C6C;font-size: 15px;">关闭</el-button>
					</div>
				</el-col>
			</el-row>
			<br/>
			<div style="background-color: white;color:#F56C6C">
				<el-row :span="10">
					<el-col :md="1" :push="18">
						<el-button style="background-color: white;color:#F56C6C" @click="updatefieldvehicles">保存</el-button>
					</el-col>
					<el-col :md="1" :push="18" style="margin-left: 20px;">
						<el-button style="background-color: white;color:#F56C6C">删除</el-button>
					</el-col>
					<el-col :md="1" :push="18" style="margin-left: 20px;">
						<el-button style="background-color: white;color:#F56C6C" @click="insertfieldvehicles">新增</el-button>
					</el-col>
				</el-row>
			</div>
			<div style="background-color: white;color:#F56C6C">
				车牌号
				<el-input v-model="addfieldvehicles.carnumber" size="small" placeholder="请输入内容" style="width: 150px;">
				</el-input>

				品牌
				<el-input v-model="addfieldvehicles.fbrand" size="small" placeholder="请输入内容" style="width: 150px;">
				</el-input>
				车型
				<el-input v-model="addfieldvehicles.fmodel" size="small" placeholder="请输入内容" style="width: 150px;">
				</el-input>
				当前里程
				<el-input v-model="addfieldvehicles.currentmileage" size="small" placeholder="请输入内容" style="width: 150px;">
				</el-input>
				班组
				<template>
					<el-select v-model="value" placeholder="请选择">
						<el-option v-for="item in Team" :key="item.teamid" :label="item.tename" :value="item.teamid">
						</el-option>
					</el-select>
				</template>
			</div>
			<el-table ref="singleTable" @current-change="fuzhi" :data="fieldvehicles" highlight-current-row style="background-color: white;color:#F56C6C">
				<el-table-column prop="carnumber" label="车牌号">
				</el-table-column>
				<el-table-column prop="fbrand" label="品牌">
				</el-table-column>
				<el-table-column prop="fmodel" label="车型">
				</el-table-column>
				<el-table-column prop="currentmileage" label="当前里程">
				</el-table-column>
				<el-table-column prop="tename" label="归属班组">
				</el-table-column>
			</el-table>
		</div>
	</body>
	<script>
		var fieldvehiclesapp=new Vue({
			el: "#fieldvehiclesapp",
			data: {
				addfieldvehicles: {
					id:0,
					carnumber: '',
					fbrand: '',
					fmodel: '',
					currentmileage: '',
					tename:'',
					teamid:0
				},
				fieldvehicles: [],
				Team: [],
				value: ''
			},
			mounted() {
				this.goToPage();
				this.queryTeam();
			},
			methods: {
				fuzhi(currentRow,oldCurrenRow){
					if(currentRow==null){
						return;
					}
					fieldvehiclesapp.addfieldvehicles.carnumber=currentRow.carnumber;
					fieldvehiclesapp.addfieldvehicles.fbrand=currentRow.fbrand;
					fieldvehiclesapp.addfieldvehicles.fmodel=currentRow.fmodel;
					fieldvehiclesapp.addfieldvehicles.currentmileage=currentRow.currentmileage;
					fieldvehiclesapp.addfieldvehicles.tename=currentRow.tename;
					fieldvehiclesapp.addfieldvehicles.id=currentRow.id;
					for(var i=0;i<this.Team.length;i++){
						if(currentRow.tename==this.Team[i].tename){
							this.value=this.Team[i].teamid;
							break;
						}
					}
				},
				goToPage() {
						let _this = this;
						axios.get(`http://127.0.0.1:8080/dzw_moblie/api/fiel/query`).then(function(resp) {
							_this.fieldvehicles = resp.data;
						}).catch(function(e) {
							console.info(e);
						});
					},
				insertfieldvehicles() {
					this.addfieldvehicles.teamid=parseInt(this.value);
					axios.post("http://127.0.0.1:8080/dzw_moblie/api/fiel/insert", this.addfieldvehicles).then(function(resp) {
						if(resp.data.code == "200") {
							alert('新增成功');
							fieldvehiclesapp.goToPage();
						}
					}).catch(function(e) {});
				},
				updatefieldvehicles() {
					alert(this.addfieldvehicles.id);
					
					this.addfieldvehicles.teamid=parseInt(this.value);
					alert(this.addfieldvehicles.teamid);
					axios.put("http://127.0.0.1:8080/dzw_moblie/api/fiel/update", this.addfieldvehicles).then(function(resp) {
						if(resp.data.code == "200") {
							alert('更新成功');
							fieldvehiclesapp.goToPage();
						}
					}).catch(function(e) {});
				},
				queryTeam(){
						let _this = this;
						axios.get(`http://127.0.0.1:8080/dzw_moblie/api/fiel/queryteam`).then(function(resp) {
							_this.Team = resp.data;
						})
				}
			}
		});
	</script>

</html>